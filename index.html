
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>夏由里 | 插畫作品集</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind 設定 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Helvetica Neue"', 'Arial', '"Heiti TC"', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#F9F9F9]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- 圖示組件 (模擬 Lucide React) ---
        const IconBase = ({ size = 24, className = "", children, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Donut = (props) => <IconBase {...props}><path d="M20.5 10a2.5 2.5 0 0 1-2.4-3H18a2.97 2.97 0 0 0-4.42-2.49L9.15 11.2A7.98 7.98 0 0 0 3.84 13.9a7.53 7.53 0 0 0 5.86 1.48L11.75 12"/><path d="M5.52 16.8a8.03 8.03 0 0 0 13.68-.45"/><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></IconBase>;
        const Facebook = (props) => <IconBase {...props}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></IconBase>;
        const Mail = (props) => <IconBase {...props}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>;
        const LayoutGrid = (props) => <IconBase {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></IconBase>;
        const Smile = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></IconBase>;
        const PenTool = (props) => <IconBase {...props}><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>;
        const XCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></IconBase>;

        // 自定義 Plurk 圖示 (與原始碼相同)
        const PlurkIcon = ({ size = 24, className }) => (
            <svg 
            width={size} 
            height={size} 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            strokeWidth="2" 
            strokeLinecap="round" 
            strokeLinejoin="round"
            className={className}
            >
            <path d="M6 4v16" />
            <path d="M6 4h6a6 6 0 0 1 0 12h-6" />
            </svg>
        );

        // --- 設定與資料 ---
        const STATUS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1O7HyFnZuDqmtCl6Xx-DOGUfkiYU3N5bh6RxOAUpGPhUIM_MUGpp2eUoi02D3nJ7pGDs3bMMmeFov/pub?gid=1522759652&single=true&output=csv"; 
        const PORTFOLIO_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1O7HyFnZuDqmtCl6Xx-DOGUfkiYU3N5bh6RxOAUpGPhUIM_MUGpp2eUoi02D3nJ7pGDs3bMMmeFov/pub?gid=1097263730&single=true&output=csv"; 

        const DEFAULT_QUEUE = [
            { id: 1, name: "範例-K***", status: "草稿確認中", progress: 30 },
            { id: 2, name: "範例-M***", status: "底色繪製中", progress: 60 },
            { id: 3, name: "範例-S***", status: "細化完稿中", progress: 90 },
        ];

        const INITIAL_CATEGORIES = [
        { 
            id: 'normal', 
            name: '正比', 
            items: [
            { 
                title: '正比頭貼', 
                urls: [
                "https://images.plurk.com/uO75w0OLVQZTLHj2YLgLt.jpg",
                "https://images.plurk.com/4OmcOtem9blDuA8sLCBWoQ.jpg",
                "https://images.plurk.com/79tDwfnBjat2R76ZNwevjS.jpg",
                "https://images.plurk.com/1rfEPGkKYeSNkcUasUcJ8y.jpg",
                "https://images.plurk.com/6sDB8OsMOs2ugAYOEGZmVu.jpg",
                "https://images.plurk.com/4H10D5mfVAqBNaj3TkmhmZ.jpg",
                "https://images.plurk.com/44s1JcxjA5LnSaBlUen7du.jpg"
                ], 
                count: 5, 
                colorTone: 'blue' 
            },
            { 
                title: '正比半身', 
                urls: [
                "https://images.plurk.com/2x5FoWpwpweO5nDTxT5fPF.jpg",
                "https://images.plurk.com/1FOXbYYul1sIE7OOGXVMMg.jpg",
                "https://images.plurk.com/4DDFxixdyEmvAjhrapyOF9.jpg",
                "https://images.plurk.com/7G6rlygQMSSofos1rSTnwR.jpg",
                "https://images.plurk.com/6UehkANd2TUJLKzDR30kR0.jpg",
                "https://images.plurk.com/7l4BPIENRi1lP5OWGFuKaS.jpg",
                "https://images.plurk.com/65Cd3waiS2QsxAarj5U4xb.jpg",
                "https://images.plurk.com/1CuK8rdC2k9Fkdg1CeQaUp.jpg"
                ], 
                count: 4, 
                colorTone: 'slate',
                heightClass: "h-[282px]"
            },
            { 
                title: '半身插圖', 
                urls: [], 
                count: 4, 
                colorTone: 'indigo',
                heightClass: "h-[282px]"
            },
            { 
                title: '全身立繪', 
                urls: [
                "https://images.plurk.com/qUFyEDCDwx1YS3fN5w6RH.jpg",
                "https://images.plurk.com/43ayprKbbN9YoeRa10ET7T.jpg",
                "https://images.plurk.com/10b9t9RTrau6ggLEkrPb3l.jpg",
                "https://images.plurk.com/3rWr3FQqPptoUvJzS6dfv1.jpg",
                "https://images.plurk.com/27Wj9r2z7sJqbnzEjvVttg.jpg",
                "https://images.plurk.com/5U3rmt9p1sP8QYeritoGMh.jpg"
                ], 
                count: 4, 
                colorTone: 'teal',
                heightClass: "h-[282px]"
            }
            ] 
        },
        { 
            id: 'chibi', 
            name: 'Ｑ版', 
            items: [
            { 
                title: 'Ｑ版頭貼', 
                urls: [
                    "https://images.plurk.com/5Y1wlUe39tFDXqXf51QmNo.jpg",
                    "https://images.plurk.com/37PqU8G8DpMGwR8AXnOpKV.jpg",
                    "https://images.plurk.com/34izE34Gr6doNjm48Mrjck.jpg",
                    "https://images.plurk.com/5hIxbqwCxejnayotWY7i2D.jpg",
                    "https://images.plurk.com/zQ92Hf0OiZc3hH5zfc4uS.jpg"
                ], 
                count: 6, 
                colorTone: 'rose' 
            },
            { 
                title: 'Ｑ版全身', 
                urls: [
                "https://images.plurk.com/1PV4qjhyqgQ3JlrGmz784g.jpg",
                "https://images.plurk.com/4Jw62PCKlw0eyEPAbxmtMF.jpg",
                "https://images.plurk.com/mcmooy8E1pPfluJ6hAmwT.jpg",
                "https://images.plurk.com/2MOWQ24Q7Kr2WHprJq4FPh.jpg",
                "https://images.plurk.com/6WYC0lfzAeJtgjPEIkTDam.jpg",
                "https://images.plurk.com/6Bj4OTxzAb8W8gNaZ0ZKXu.jpg",
                "https://images.plurk.com/2K5GNk3hX3mwx1RDA2VQc4.jpg",
                "https://images.plurk.com/7w4diGK7VWgbFE9w1Mdjw7.jpg",
                "https://images.plurk.com/6R0Aj9Ml7wU6IcGb7Vk6tG.jpg",
                "https://images.plurk.com/3t5oKZ1BnfGdUJWV3dTPSi.jpg"
                ], 
                count: 5, 
                colorTone: 'orange' 
            },
            { 
                title: 'Ｑ版插圖', 
                urls: [
                "https://images.plurk.com/6chk7xnKVuyUIzHFGhdbor.jpg",
                "https://images.plurk.com/78hHxAFlBCSIV5dlUmhKK8.jpg",
                "https://images.plurk.com/5pImFw6KSyOQsf4TCQgWZO.jpg",
                "https://images.plurk.com/5yrzLQOcyFKEsZuxTEtBY7.jpg",
                "https://images.plurk.com/6UKt7nrsckHs8qbrSplWsm.jpg"
                ], 
                count: 4, 
                colorTone: 'pink',
                widthClass: "min-w-[288px] w-[260px]" 
            },
            { 
                title: '服裝設計', 
                urls: [
                "https://images.plurk.com/6HartYiK9jAXXeTpTExTsz.jpg",
                "https://images.plurk.com/72FZTwMGCWz1FMm802P3xM.jpg",
                "https://images.plurk.com/7ba4OPL8bFYC7g8wSQwBlZ.jpg"
                ], 
                count: 3, 
                colorTone: 'indigo',
                widthClass: "min-w-[220px] w-[220px]" 
            }
            ] 
        },
        { 
            id: 'other', 
            name: '其他', 
            items: [
            { 
                title: '簡單線條', 
                urls: [], 
                count: 5, 
                colorTone: 'gray',
                heightClass: "h-[282px]" 
            },
            { 
                title: '黑白塗鴉', 
                urls: [
                "https://images.plurk.com/4L4tnNaehQODD4p8avtPxc.jpg",
                "https://images.plurk.com/6Hb1fOuh7BrpIrXrw0jYl1.jpg",
                "https://images.plurk.com/3UqRaIDahvGzHAjS2rqzO9.jpg",
                ], 
                count: 3, 
                colorTone: 'stone',
                heightClass: "h-[282px]" 
            },
            { 
                title: 'LINE貼圖', 
                urls: [], 
                count: 6, 
                colorTone: 'emerald' 
            }
            ] 
        },
        ];

        // 模擬作品圖片組件
        const ArtItem = ({ color, text, subText, imageUrl }) => (
        <div className={`w-full h-full ${!imageUrl ? color : 'bg-slate-100'} flex flex-col items-center justify-center text-slate-600/70 rounded-2xl overflow-hidden relative group transition-all duration-300 hover:shadow-md`}>
            {imageUrl ? (
            <img src={imageUrl} alt={text} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
            ) : (
            <>
                <div className="absolute inset-0 bg-white/0 group-hover:bg-white/30 transition-all duration-500"></div>
                <Sparkles className="absolute top-2 right-2 w-4 h-4 opacity-30 group-hover:opacity-60 transition-opacity" />
                <span className="text-xs tracking-widest font-light z-10">{text}</span>
                {subText && <span className="text-[10px] opacity-60 mt-1 tracking-wider z-10">{subText}</span>}
            </>
            )}
            {imageUrl && (
            <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div>
            )}
        </div>
        );

        // 價目表資料
        const priceList = [
        {
            category: "正比系列",
            targetId: 'normal', 
            theme: {
                borderHover: "hover:border-blue-200",
                icon: "text-blue-300 group-hover:text-blue-500",
                highlight: "group-hover:text-blue-500"
            },
            items: [
            { title: "正比頭貼", price: "NT. 800+", desc: "精緻全彩 / 含簡易背景裝飾 / 可加價繪製物件", tags: ["頭貼", "精緻"] },
            { title: "正比半身", price: "NT. 2000+", desc: "範圍腰部以上 / 動作可指定 / 背景另外加價", tags: ["插圖", "氛圍"] },
            { title: "半身插圖", price: "NT. 3000+", desc: "包含精緻背景 / 完整構圖 / 氛圍感強烈", tags: ["插圖", "背景"] },
            { title: "全身立繪", price: "NT. 2500+", desc: "可加價角色設計、排版表情差分 / 完整細節", tags: ["立繪", "設計"] },
            ]
        },
        {
            category: "Ｑ版系列",
            targetId: 'chibi', 
            theme: {
                borderHover: "hover:border-rose-200",
                icon: "text-rose-300 group-hover:text-rose-500",
                highlight: "group-hover:text-rose-500"
            },
            items: [
            { title: "Ｑ版頭貼", price: "NT. 600+", desc: "可愛簡約大頭 / 可加價繪製多物件", tags: ["可愛", "大頭"] },
            { title: "Ｑ版全身", price: "NT. 800+", desc: "可製作飯友 / 可配合大物件&動物等", tags: ["全身", "動態"] },
            { title: "Ｑ版插圖", price: "NT. 1500+", desc: "包含光影背景 / 氛圍感", tags: ["插圖", "豐富"] },
            { title: "服裝設計", price: "NT. 1500+", desc: "Ｑ版素體 / 含服裝配件", tags: ["拆分", "設計"] },
            ]
        },
        {
            category: "其他項目",
            targetId: 'other', 
            theme: {
                borderHover: "hover:border-emerald-200",
                icon: "text-emerald-300 group-hover:text-emerald-600",
                highlight: "group-hover:text-emerald-600"
            },
            items: [
            { title: "簡單線條", price: "NT. 300+", desc: "單色線條 / 簡單上色", tags: ["極簡", "快速"] },
            { title: "黑白塗鴉", price: "NT. 800+", desc: "正比隨筆 / 氛圍感", tags: ["塗鴉", "黑白"] },
            { title: "貼圖", price: "NT. 1500+", desc: "靜態貼圖 / 一組 8 張", tags: ["實用", "貼圖"] },
            ]
        }
        ];

        const getColorClass = (tone, index) => {
        const intensities = [100, 200, 50, 300, 100, 200];
        const intensity = intensities[index % intensities.length];
        
        const map = {
            blue: `bg-blue-${intensity}`,
            slate: `bg-slate-${intensity}`,
            teal: `bg-teal-${intensity}`,
            rose: `bg-rose-${intensity}`,
            orange: `bg-orange-${intensity}`,
            pink: `bg-pink-${intensity}`,
            indigo: `bg-indigo-${intensity}`,
            gray: `bg-gray-${intensity}`,
            stone: `bg-stone-${intensity}`,
            emerald: `bg-emerald-${intensity}`,
        };
        return map[tone] || `bg-slate-${intensity}`;
        };

        // ★★★ 強力 CSV 解析器：正確處理引號與換行 ★★★
        const parseCSV = (text) => {
        const rows = [];
        let currentRow = [];
        let currentVal = '';
        let inQuote = false;
        
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const nextChar = text[i + 1];
            
            if (char === '"') {
                if (inQuote && nextChar === '"') {
                    // 遇到兩個雙引號，視為一個普通的雙引號
                    currentVal += '"';
                    i++; 
                } else {
                    // 切換引號狀態
                    inQuote = !inQuote;
                }
            } else if (char === ',' && !inQuote) {
                // 欄位結束
                currentRow.push(currentVal);
                currentVal = '';
            } else if ((char === '\r' || char === '\n') && !inQuote) {
                // 行結束
                if (char === '\r' && nextChar === '\n') i++;
                currentRow.push(currentVal);
                if (currentRow.length > 0 && (currentRow.length > 1 || currentRow[0] !== '')) {
                    rows.push(currentRow);
                }
                currentRow = [];
                currentVal = '';
            } else {
                currentVal += char;
            }
        }
        if (currentVal || currentRow.length > 0) {
            currentRow.push(currentVal);
            rows.push(currentRow);
        }
        return rows;
        };

        // 輔助函式：清理 CSV 儲存格的引號
        const cleanCSVValue = (val) => {
        if (!val) return '';
        return val.trim().replace(/^"|"$/g, '').replace(/""/g, '"');
        };

        // 升級版 Fetch 函式
        const fetchDataFromCSV = async (url) => {
            const timestamp = new Date().getTime();
            const separator = url.includes('?') ? '&' : '?';
            const urlWithTimestamp = `${url}${separator}_t=${timestamp}`;
            
            const proxies = [
                `https://corsproxy.io/?${encodeURIComponent(urlWithTimestamp)}`,
                `https://api.allorigins.win/raw?url=${encodeURIComponent(urlWithTimestamp)}`,
                `https://thingproxy.freeboard.io/fetch/${urlWithTimestamp}`
            ];

            for (const proxyUrl of proxies) {
                try {
                    const response = await fetch(proxyUrl);
                    if (response.ok) {
                        let text = await response.text();
                        // 移除 BOM (Byte Order Mark)
                        if (text.charCodeAt(0) === 0xFEFF) {
                            text = text.slice(1);
                        }
                        // 檢查 HTML
                        if (text.trim().startsWith('<!DOCTYPE html') || text.trim().startsWith('<html')) {
                            continue; 
                        }
                        return text;
                    }
                } catch (err) {
                    console.warn(`Proxy failed: ${proxyUrl}`, err);
                }
            }
            throw new Error("All proxies failed to fetch CSV data.");
        };

        function ArtistPortfolio() {
        const [activePage, setActivePage] = useState('home');
        const [queueData, setQueueData] = useState(DEFAULT_QUEUE);
        const [isLoadingQueue, setIsLoadingQueue] = useState(false);
        const [portfolioData, setPortfolioData] = useState(INITIAL_CATEGORIES);
        const [fetchError, setFetchError] = useState(null);
        const [debugLog, setDebugLog] = useState([]); // 新增：除錯訊息
        const [activePortfolioTab, setActivePortfolioTab] = useState('normal');
        const [activePriceTab, setActivePriceTab] = useState(0);

        const addDebugLog = (msg) => {
            console.log(msg);
            setDebugLog(prev => [...prev.slice(-4), msg]); 
        };

        const fetchStatus = useCallback(async () => {
            if (!STATUS_CSV_URL) return;
            setIsLoadingQueue(true);
            setFetchError(null);
            try {
                const text = await fetchDataFromCSV(STATUS_CSV_URL);
                const rows = parseCSV(text); 
                const dataRows = rows.slice(1);
                const parsedData = dataRows.map((row, index) => {
                    if (row.length < 3) return null;
                    return {
                        id: index + 1,
                        name: cleanCSVValue(row[0]),
                        status: cleanCSVValue(row[1]),
                        progress: parseInt(cleanCSVValue(row[2]).replace('%', '')) || 0
                    };
                }).filter(Boolean);
                if (parsedData.length > 0) setQueueData(parsedData);
            } catch (error) {
                console.error("排單讀取錯誤:", error);
                setFetchError("暫時無法同步雲端");
            } finally {
                setIsLoadingQueue(false);
            }
        }, []);

        const fetchPortfolio = useCallback(async () => {
            if (!PORTFOLIO_CSV_URL) return;
            try {
                const text = await fetchDataFromCSV(PORTFOLIO_CSV_URL);
                const rows = parseCSV(text);
                const newPortfolioData = JSON.parse(JSON.stringify(INITIAL_CATEGORIES));
                newPortfolioData.forEach(cat => cat.items.forEach(item => item.urls = []));

                let successCount = 0;
                const categoryMap = {
                    'normal': 'normal', '正比': 'normal', '正比系列': 'normal',
                    'chibi': 'chibi', 'q版': 'chibi', 'Ｑ版': 'chibi', 'q版系列': 'chibi', 'Ｑ版系列': 'chibi',
                    'other': 'other', '其他': 'other', '其他項目': 'other'
                };

                let startIndex = 0;
                if (rows.length > 0) {
                    const firstRowStr = rows[0].join('').toLowerCase();
                    if (firstRowStr.includes('category') || firstRowStr.includes('分類')) {
                        startIndex = 1;
                    }
                }

                for (let i = startIndex; i < rows.length; i++) {
                    const cols = rows[i];
                    if (cols.length < 3) continue;

                    const rawCat = cleanCSVValue(cols[0]).toLowerCase();
                    const categoryId = categoryMap[rawCat] || rawCat;
                    const itemTitle = cleanCSVValue(cols[1]);
                    const imageUrlRaw = cleanCSVValue(cols.slice(2).join(' '));

                    if (!categoryId || !itemTitle || !imageUrlRaw) continue;

                    const category = newPortfolioData.find(c => c.id.toLowerCase() === categoryId);
                    if (category) {
                        const targetTitleClean = itemTitle.replace(/\s+/g, '').toLowerCase();
                        const item = category.items.find(itm => {
                            const sourceTitleClean = itm.title.replace(/\s+/g, '').toLowerCase();
                            return sourceTitleClean === targetTitleClean || sourceTitleClean.includes(targetTitleClean);
                        });

                        if (item) {
                            // 支援換行、空格、逗號分隔
                            const urls = imageUrlRaw.split(/[\s,\n]+/).filter(url => url.length > 5 && url.startsWith('http'));
                            if (urls.length > 0) {
                                item.urls.push(...urls);
                                successCount++;
                            }
                        } else {
                            if (i < 5) addDebugLog(`找不到項目: "${itemTitle}"`);
                        }
                    } else {
                        if (i < 5) addDebugLog(`找不到分類: "${rawCat}"`);
                    }
                }

                if (successCount > 0) {
                    setPortfolioData(newPortfolioData);
                    addDebugLog(`成功載入 ${successCount} 張圖片`);
                } else {
                    addDebugLog("讀取成功但無效資料。請檢查試算表內容");
                }

            } catch (error) {
                console.error("作品集讀取錯誤:", error);
                addDebugLog(`連線失敗: ${error.message}`);
            }
        }, []);

        useEffect(() => {
            fetchStatus();
            fetchPortfolio();
        }, [fetchStatus, fetchPortfolio]);

        const scrollTo = (id) => {
            const element = document.getElementById(id);
            if (element) {
            element.scrollIntoView({ behavior: 'smooth' });
            setActiveSection(id);
            }
        };

        const handleJumpToCategory = (targetTab) => {
            setActivePortfolioTab(targetTab);
            setActivePage('portfolio');
        };

        const handleNavClick = (pageId) => {
            setActivePage(pageId);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const renderContent = () => {
            switch (activePage) {
            case 'home':
                return (
                <div className="animate-fade-in-up">
                    <header className="pt-28 pb-12 overflow-hidden flex flex-col items-center justify-center min-h-[80vh]">
                    <div className="text-center mb-10 space-y-3">
                        <div className="inline-block px-3 py-1 rounded-full bg-[#EFF2F1] text-[#6A857D] text-[10px] tracking-[0.2em] font-medium border border-[#E5EBE9]">
                        ILLUSTRATION & DESIGN
                        </div>
                        <h1 className="text-xl md:text-2xl font-bold tracking-[0.15em] text-slate-700">
                        早上起不來（由里）
                        </h1>
                        <p className="text-xs text-slate-500 tracking-widest font-light">
                        早上和棉被辦婚禮，中午還在洞房，目前離不開被窩
                        </p>
                    </div>

                    <div className="w-full relative py-4">
                        <div className="absolute inset-y-0 left-0 w-20 bg-gradient-to-r from-[#F9F9F9] to-transparent z-10"></div>
                        <div className="absolute inset-y-0 right-0 w-20 bg-gradient-to-l from-[#F9F9F9] to-transparent z-10"></div>
                        <div className="w-full overflow-hidden whitespace-nowrap">
                        <div className="marquee-content gap-4 px-4">
                            {[...Array(2)].map((_, i) => (
                            <div key={i} className="flex gap-4">
                                <div className="w-64 h-40 bg-[#E1E6EB] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#E1E6EB]" text="Artwork 01" /></div>
                                <div className="w-64 h-40 bg-[#E1EBE8] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#E1EBE8]" text="Artwork 02" /></div>
                                <div className="w-64 h-40 bg-[#E3E3EA] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#E3E3EA]" text="Artwork 03" /></div>
                                <div className="w-64 h-40 bg-[#EBE3E3] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#EBE3E3]" text="Artwork 04" /></div>
                                <div className="w-64 h-40 bg-[#EBE8E1] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#EBE8E1]" text="Artwork 05" /></div>
                                <div className="w-64 h-40 bg-[#E1EBE4] rounded-2xl flex-shrink-0"><ArtItem color="bg-[#E1EBE4]" text="Artwork 06" /></div>
                            </div>
                            ))}
                        </div>
                        </div>
                    </div>
                    </header>
                </div>
                );
            case 'about':
                return (
                <section className="py-20 px-6 bg-white text-center min-h-screen animate-fade-in-up">
                    <div className="max-w-md mx-auto pt-20">
                    <div className="w-24 h-24 mx-auto rounded-full bg-gradient-to-tr from-slate-200 to-gray-200 p-1 mb-6">
                        <div className="w-full h-full bg-white rounded-full overflow-hidden">
                            <ArtItem color="bg-[#F9F9F9]" text="ME" imageUrl="https://images.plurk.com/1TSnCrvhnKFYHxzG0pF2E9.jpg" />
                        </div>
                    </div>
                    <h2 className="text-lg font-bold tracking-[0.2em] text-slate-600 mb-2">夏由里</h2>
                    <p className="text-xs text-slate-500 tracking-widest font-light mb-8 leading-7">
                        視覺傳達設計系畢業<br/>
                        喜歡甜點、貓咪與回籠覺。<br/>
                        小孩子外表的阿姨，<br/>
                        再拆一層會發現裡面還是屁孩
                    </p>
                    <div className="flex justify-center gap-4">
                        <a href="#" className="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-500 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-100 transition-all hover:-translate-y-1"><Facebook size={16} /></a>
                        <a href="#" className="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-500 hover:bg-orange-50 hover:text-[#cf682f] hover:border-orange-100 transition-all hover:-translate-y-1"><PlurkIcon size={16} /></a>
                        <a href="#" className="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-500 hover:bg-[#E6EBF0] hover:text-[#7A8C99] hover:border-[#E6EBF0] transition-all hover:-translate-y-1"><Mail size={16} /></a>
                    </div>
                    </div>
                </section>
                );
            case 'portfolio':
                const portfolioTabs = ['normal', 'chibi', 'other'];
                const activePortfolioIndex = portfolioTabs.indexOf(activePortfolioTab);
                
                return (
                <section className="py-20 px-6 bg-[#F9F9F9] min-h-screen animate-fade-in-up">
                    <div className="max-w-6xl mx-auto pt-10">
                    <div className="flex flex-col items-center gap-2 mb-12">
                        <h2 className="text-lg font-medium tracking-widest text-slate-700">精選範例</h2>
                        <p className="text-[10px] text-slate-400 mt-2 tracking-widest font-light">點選類別查看不同範例</p>
                        
                        <div className="relative flex p-1 bg-slate-100 rounded-full mt-4 w-fit">
                            <div 
                                className="absolute top-1 bottom-1 bg-white rounded-full shadow-sm transition-all duration-300 ease-out"
                                style={{ 
                                    left: `${activePortfolioIndex * 33.33 + 0.5}%`, 
                                    width: '32%' 
                                }}
                            ></div>
                            
                            {portfolioData.map((cat) => (
                            <button
                                key={cat.id}
                                onClick={() => setActivePortfolioTab(cat.id)}
                                className={`relative z-10 px-6 py-2 rounded-full text-xs tracking-widest transition-colors duration-300 w-24 ${
                                activePortfolioTab === cat.id 
                                ? 'text-slate-700 font-medium' 
                                : 'text-slate-400 hover:text-slate-600'
                                }`}
                            >
                                {cat.name}
                            </button>
                            ))}
                        </div>
                    </div>

                    <div key={activePortfolioTab} className="space-y-12 animate-slide-up">
                        {portfolioData.find(c => c.id === activePortfolioTab)?.items.map((subItem, idx) => (
                        <div key={idx} className="space-y-4">
                            <div className="flex items-center gap-2 px-2">
                            <div className="w-1 h-4 bg-slate-200 rounded-full"></div>
                            <h3 className="text-sm text-slate-600 tracking-widest font-medium">{subItem.title}</h3>
                            <span className="text-[10px] text-slate-300 font-light ml-auto flex items-center gap-1">
                                左右滑動查看 <ChevronRight size={10} />
                            </span>
                            </div>
                            
                            <div className="flex overflow-x-auto gap-4 pb-4 px-2 snap-x snap-mandatory hide-scrollbar">
                            {(() => {
                                const hasImages = subItem.urls && subItem.urls.length > 0;
                                const itemsToRender = hasImages ? subItem.urls : [...Array(subItem.count)];
                                
                                return itemsToRender.map((itemContent, imgIndex) => {
                                const colorClass = getColorClass(subItem.colorTone, imgIndex);
                                let widthClass = subItem.widthClass || "min-w-[200px] w-[200px]";
                                const imageUrl = hasImages ? itemContent : null;
                                let heightClass = subItem.heightClass || "h-48";
                                
                                if (subItem.title === '半身插圖' && imgIndex === itemsToRender.length - 1) {
                                    widthClass = "min-w-[400px] w-[400px]";
                                }

                                return (
                                    <div key={imgIndex} className={`${widthClass} ${heightClass} snap-center flex-shrink-0`}>
                                    <ArtItem 
                                        color={colorClass} 
                                        text={subItem.title} 
                                        subText={`Sample ${String(imgIndex + 1).padStart(2, '0')}`}
                                        imageUrl={imageUrl}
                                    />
                                    </div>
                                );
                                });
                            })()}
                            </div>
                        </div>
                        ))}
                    </div>
                    </div>
                </section>
                );
            case 'pricing':
                return (
                <section className="py-20 px-6 max-w-5xl mx-auto bg-white min-h-screen animate-fade-in-up">
                    <div className="pt-10 flex flex-col items-center gap-3 mb-12 justify-center">
                    <h2 className="text-lg font-medium tracking-widest text-slate-700">委託項目</h2>
                    
                        <div className="relative flex p-1 bg-slate-100 rounded-full w-fit">
                            <div 
                                className="absolute top-1 bottom-1 bg-white rounded-full shadow-sm transition-all duration-300 ease-out"
                                style={{ 
                                    left: `${activePriceTab * 33.33 + 0.5}%`, 
                                    width: '32%' 
                                }}
                            ></div>

                            {priceList.map((category, index) => (
                            <button
                                key={index}
                                onClick={() => setActivePriceTab(index)}
                                className={`relative z-10 px-6 py-2 rounded-full text-xs tracking-widest transition-colors duration-300 w-28 ${
                                activePriceTab === index 
                                ? 'text-slate-700 font-medium' 
                                : 'text-slate-400 hover:text-slate-600'
                                }`}
                            >
                                {category.category}
                            </button>
                            ))}
                        </div>
                    </div>

                    <div className="min-h-[400px]">
                    {(() => {
                        const category = priceList[activePriceTab];
                        const catIndex = activePriceTab;
                        
                        return (
                        <div key={catIndex} className="animate-slide-up">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {category.items.map((item, index) => (
                                <div key={index} className={`group relative bg-white rounded-[2rem] p-5 border border-slate-100 ${category.theme.borderHover} transition-all duration-300 hover:shadow-xl hover:shadow-slate-200/40`}>
                                <div 
                                    onClick={() => handleJumpToCategory(category.targetId)}
                                    className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white border border-slate-100 rounded-full flex items-center justify-center group-hover:bg-[#F2F5F4] transition-colors cursor-pointer hover:scale-110 duration-300 z-10 shadow-sm"
                                    title="點擊查看範例"
                                >
                                    {catIndex === 0 && <LayoutGrid size={16} strokeWidth={1.5} className={`text-slate-300 ${category.theme.icon}`} />}
                                    {catIndex === 1 && <Smile size={16} strokeWidth={1.5} className={`text-slate-300 ${category.theme.icon}`} />}
                                    {catIndex === 2 && <PenTool size={16} strokeWidth={1.5} className={`text-slate-300 ${category.theme.icon}`} />}
                                </div>
                                
                                <div className="text-center mt-4">
                                    <h3 className="text-xs font-medium tracking-widest text-slate-700 mb-2">{item.title}</h3>
                                    <div className="text-lg font-light text-slate-800 font-sans mb-3">{item.price}</div>
                                    <div className="w-6 h-px bg-slate-200 mx-auto mb-3"></div>
                                    <p className="text-[10px] text-slate-500 mb-4 leading-relaxed min-h-[4em]">{item.desc}</p>
                                    
                                    <div className="flex flex-wrap gap-1.5 justify-center">
                                    {item.tags.map((tag, i) => (
                                        <span key={i} className="px-2 py-1 rounded-md bg-[#F7F9F9] text-[9px] text-slate-500 tracking-wider">
                                        #{tag}
                                        </span>
                                    ))}
                                    </div>
                                </div>
                                </div>
                            ))}
                            </div>
                        </div>
                        );
                    })()}
                    </div>
                </section>
                );
            case 'status':
                return (
                <section className="py-20 px-6 max-w-4xl mx-auto min-h-screen animate-fade-in-up">
                    <div className="pt-20 flex items-center gap-3 mb-8 justify-center relative">
                    <div className="h-px w-8 bg-slate-300"></div>
                    <h2 className="text-lg font-medium tracking-widest text-slate-700">目前狀態</h2>
                    <div className="h-px w-8 bg-slate-300"></div>
                    
                    <button 
                        onClick={fetchStatus} 
                        disabled={isLoadingQueue}
                        className="absolute right-0 md:-right-12 p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-all"
                        title="重新整理排單"
                    >
                        <RefreshCw size={14} className={isLoadingQueue ? "animate-spin text-[#7A9089]" : ""} />
                    </button>
                    </div>

                    <div className="grid md:grid-cols-3 gap-6">
                    <div className="md:col-span-1 glass-panel rounded-3xl p-6 text-center space-y-4 flex flex-col justify-center items-center">
                        <div className="w-16 h-16 mx-auto rounded-full bg-[#F0F4F3] flex items-center justify-center text-[#7A9089]">
                        <Sparkles size={24} strokeWidth={1.5} />
                        </div>
                        <div>
                        <h3 className="text-sm font-medium tracking-widest text-slate-700">委託開放中</h3>
                        <p className="text-[11px] text-slate-500 mt-2 leading-relaxed font-light">
                            目前排單約需等待 2-3 週<br/>歡迎私訊詢問檔期
                        </p>
                        </div>
                    </div>

                    <div className="md:col-span-2 space-y-3 relative min-h-[200px]">
                        {isLoadingQueue && (
                        <div className="absolute inset-0 bg-white/80 z-20 flex flex-col items-center justify-center backdrop-blur-sm rounded-2xl transition-opacity duration-300">
                            <RefreshCw className="animate-spin text-[#7A9089] mb-2" size={24} />
                            <span className="text-xs text-slate-500 tracking-widest">同步雲端資料中...</span>
                        </div>
                        )}
                        
                        {queueData.map((item) => (
                        <div key={item.id} className="bg-white rounded-2xl p-4 flex items-center justify-between shadow-sm border border-slate-100 hover:border-[#DCE6E2] transition-colors duration-300">
                            <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-[10px] text-slate-500 font-medium">
                                {item.id.toString().padStart(2, '0')}
                            </div>
                            <div>
                                <div className="text-xs font-medium text-slate-700 tracking-wider">{item.name}</div>
                                <div className="text-[10px] text-slate-500 mt-0.5">{item.status}</div>
                            </div>
                            </div>
                            <div className="w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                            <div 
                                className="h-full bg-[#8FA39D] rounded-full transition-all duration-1000 ease-out" 
                                style={{ width: `${item.progress}%` }}
                            ></div>
                            </div>
                        </div>
                        ))}
                        
                        <div className="text-center text-[10px] mt-4 tracking-widest flex items-center justify-center gap-2">
                        {fetchError ? (
                            <span className="text-red-400 flex items-center gap-1">
                            <AlertCircle size={10} /> {fetchError}
                            </span>
                        ) : (
                            <span className="text-slate-400 flex items-center gap-1">
                            {STATUS_CSV_URL ? (
                                <>
                                <CheckCircle2 size={10} className="text-[#7A9089]" /> 資料已同步自雲端
                                </>
                            ) : "僅顯示範例資料"}
                            </span>
                        )}
                        </div>
                    </div>
                    </div>
                </section>
                );
            case 'terms':
                return (
                <section className="py-20 px-6 bg-[#F5F7F8] min-h-screen animate-fade-in-up">
                    <div className="max-w-2xl mx-auto bg-white/60 backdrop-blur-md rounded-3xl p-8 md:p-12 border border-white mt-10">
                    <div className="text-center mb-10">
                        <h2 className="text-lg font-medium tracking-widest text-slate-700">注意事項</h2>
                        <p className="text-[10px] text-slate-500 mt-2">委託前請務必詳閱以下內容</p>
                    </div>
                    <div className="space-y-6">
                        <div className="flex gap-4">
                        <div className="flex-shrink-0 w-6 h-6 rounded-full bg-[#E5EBE9] flex items-center justify-center text-[#6F827D] mt-1"><CheckCircle2 size={14} /></div>
                        <div>
                            <h4 className="text-xs font-medium text-slate-700 tracking-wider mb-1">關於修改</h4>
                            <p className="text-[11px] text-slate-500 leading-relaxed font-light">草稿階段可免費修改 2 次，線稿與完稿階段僅接受設定錯誤之修正。大幅度修改需視情況加收費用。</p>
                        </div>
                        </div>
                        <div className="flex gap-4">
                        <div className="flex-shrink-0 w-6 h-6 rounded-full bg-[#E6EBF0] flex items-center justify-center text-[#7A8C99] mt-1"><FileText size={14} /></div>
                        <div>
                            <h4 className="text-xs font-medium text-slate-700 tracking-wider mb-1">授權範圍</h4>
                            <p className="text-[11px] text-slate-500 leading-relaxed font-light">委託價格默認為「非商業委託」，可個人收藏、印製少量無料。若需商用（販售、收益化影片等）請事先告知，價格 x 2.5 倍。</p>
                        </div>
                        </div>
                        <div className="flex gap-4">
                        <div className="flex-shrink-0 w-6 h-6 rounded-full bg-[#EBE6E6] flex items-center justify-center text-[#997A7A] mt-1"><AlertCircle size={14} /></div>
                        <div>
                            <h4 className="text-xs font-medium text-slate-700 tracking-wider mb-1">付款方式</h4>
                            <p className="text-[11px] text-slate-500 leading-relaxed font-light">確認草稿無誤後須先支付全額款項，收到款項後才會繼續進行繪製。支援轉帳與 PayPal。</p>
                        </div>
                        </div>
                    </div>
                    </div>
                </section>
                );
            default:
                return null;
            }
        };

        return (
            <div className="min-h-screen bg-[#F9F9F9] text-slate-600 font-sans selection:bg-slate-200 selection:text-slate-800">
            <style>{`
                .font-theme { font-weight: 300; letter-spacing: 0.1em; }
                .glass-panel { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8); }
                @keyframes scroll {
                0% { transform: translateX(0); }
                100% { transform: translateX(-50%); }
                }
                .marquee-content { display: flex; animation: scroll 20s linear infinite; }
                .hide-scrollbar::-webkit-scrollbar { display: none; }
                .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
            `}</style>

            {/* 導航列 */}
            <nav className="fixed top-0 left-0 right-0 z-50 px-6 py-4 flex justify-center">
                <div className="glass-panel rounded-full px-8 py-3 shadow-sm shadow-slate-200/30 flex items-center gap-8 text-xs font-theme text-slate-500 overflow-x-auto max-w-full">
                <button 
                    onClick={() => handleNavClick('home')} 
                    className={`${activePage === 'home' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    主頁
                </button>
                <button 
                    onClick={() => handleNavClick('about')} 
                    className={`${activePage === 'about' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    關於
                </button>
                <button 
                    onClick={() => handleNavClick('portfolio')} 
                    className={`${activePage === 'portfolio' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    範例
                </button>
                <span className="text-slate-300 hidden md:flex items-center justify-center">
                    <Donut size={14} strokeWidth={2} />
                </span>
                <button 
                    onClick={() => handleNavClick('pricing')} 
                    className={`${activePage === 'pricing' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    價目
                </button>
                <button 
                    onClick={() => handleNavClick('status')} 
                    className={`${activePage === 'status' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    排單
                </button>
                <button 
                    onClick={() => handleNavClick('terms')} 
                    className={`${activePage === 'terms' ? 'text-slate-800 font-medium' : 'hover:text-slate-800'} transition-colors whitespace-nowrap`}
                >
                    須知
                </button>
                </div>
            </nav>

            {/* 內容區塊 */}
            {renderContent()}

            {/* Footer */}
            <footer className="py-10 px-6 text-center text-[10px] text-slate-400 tracking-widest font-light">
                © 2023 Hoshino Art. All rights reserved.<br/>
                Designed with <Heart size={10} className="inline mx-1 text-slate-400" /> by You
            </footer>
            
            {/* 除錯訊息顯示 (如果有錯誤) - 新增關閉按鈕 */}
            {debugLog.length > 0 && (
                <div className="fixed bottom-0 left-0 right-0 bg-black/80 text-white text-[10px] p-2 font-mono max-h-32 overflow-y-auto z-50 flex flex-col group">
                    <button 
                        onClick={() => setDebugLog([])} 
                        className="absolute top-2 right-2 text-white/50 hover:text-white"
                        title="清除日誌"
                    >
                        <XCircle size={14} />
                    </button>
                    {debugLog.map((log, i) => <div key={i} className="mb-1">{log}</div>)}
                </div>
            )}
            </div>
        );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ArtistPortfolio />);
    </script>
</body>
</html>
